import{r as b,g as R,R as k}from"./index.CZlPm10g.js";import{B as v}from"./_astro-entry_react-toastify.CX4FvO7v.js";const w=e=>{let t;const r=new Set,n=(i,f)=>{const c=typeof i=="function"?i(t):i;if(!Object.is(c,t)){const u=t;t=f??(typeof c!="object"||c===null)?c:Object.assign({},t,c),r.forEach(l=>l(t,u))}},o=()=>t,h={setState:n,getState:o,getInitialState:()=>g,subscribe:i=>(r.add(i),()=>r.delete(i)),destroy:()=>{r.clear()}},g=t=e(n,o,h);return h},D=e=>e?w(e):w;var O={exports:{}},T={},j={exports:{}},x={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var S=b;function $(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var U=typeof Object.is=="function"?Object.is:$,A=S.useState,_=S.useEffect,C=S.useLayoutEffect,L=S.useDebugValue;function B(e,t){var r=t(),n=A({inst:{value:r,getSnapshot:t}}),o=n[0].inst,s=n[1];return C(function(){o.value=r,o.getSnapshot=t,E(o)&&s({inst:o})},[e,r,t]),_(function(){return E(o)&&s({inst:o}),e(function(){E(o)&&s({inst:o})})},[e]),L(r),r}function E(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!U(e,r)}catch{return!0}}function F(e,t){return t()}var N=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?F:B;x.useSyncExternalStore=S.useSyncExternalStore!==void 0?S.useSyncExternalStore:N;j.exports=x;var V=j.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var y=b,q=V;function J(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var W=typeof Object.is=="function"?Object.is:J,z=q.useSyncExternalStore,M=y.useRef,X=y.useEffect,G=y.useMemo,H=y.useDebugValue;T.useSyncExternalStoreWithSelector=function(e,t,r,n,o){var s=M(null);if(s.current===null){var a={hasValue:!1,value:null};s.current=a}else a=s.current;s=G(function(){function h(u){if(!g){if(g=!0,i=u,u=n(u),o!==void 0&&a.hasValue){var l=a.value;if(o(l,u))return f=l}return f=u}if(l=f,W(i,u))return l;var m=n(u);return o!==void 0&&o(l,m)?l:(i=u,f=m)}var g=!1,i,f,c=r===void 0?null:r;return[function(){return h(t())},c===null?void 0:function(){return h(c())}]},[t,r,n,o]);var d=z(e,s[0],s[1]);return X(function(){a.hasValue=!0,a.value=d},[d]),H(d),d};O.exports=T;var K=O.exports;const Q=R(K),{useDebugValue:Y}=k,{useSyncExternalStoreWithSelector:Z}=Q;const ee=e=>e;function te(e,t=ee,r){const n=Z(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return Y(n),n}const I=e=>{const t=typeof e=="function"?D(e):e,r=(n,o)=>te(t,n,o);return Object.assign(r,t),r},re=e=>e?I(e):I,p="http://localhost:3000",P={id:"",email:"",name:"",lastName:"",companyName:"",dni:"",cuit_cuil:"",address:"",locality:"",role:"",orders:[],profilePicture:""},se=re((e,t)=>({user:P,token:"",setUser:()=>{const r=JSON.parse(localStorage.getItem("user"));e({user:r})},setToken:()=>{const r=localStorage.getItem("token");e({token:r})},getUser:async r=>{try{const o=await(await fetch(`${p}/users/${r}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||t().token}`}})).json();if(Object.keys(o).includes("id"))localStorage.setItem("user",JSON.stringify(o));else throw new Error("No se pudo obtener el usuario")}catch(n){console.log(n)}},loginUser:async r=>{try{const o=await(await fetch(`${p}/auth/signin`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).json();if(o.token)return localStorage.setItem("token",o.token),o}catch(n){console.log(n)}},userRegister:async r=>{try{const n=await fetch(`${p}/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok){const s=await n.json();return v.error(`Error al registrar usuario: ${s.message}`),Promise.reject(`Error al registrar usuario: ${s.message}`)}return await n.json()}catch(n){return console.error(n),v.error("Error al comunicarse con el servidor"),Promise.reject("Error al comunicarse con el servidor")}},removeSession:()=>{e({user:P,token:""}),localStorage.removeItem("token"),localStorage.removeItem("user")},changePassword:async(r,n)=>{try{let o=JSON.stringify(r);const s=await fetch(`${p}/users/changepassword/${n}`,{method:"PUT",headers:{"Content-Type":"application/json",authorization:`Bearer ${localStorage.getItem("token")||t().token} `},body:o});if(s.ok)return await s.json();{let a=s.statusText;throw new Error(`${a}!`)}}catch(o){throw new Error(o)}},uploadImage:async(r,n)=>{const o=new FormData;o.append("file",r);try{const s=await fetch(`${p}/files/uploadImage/${n}`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")||t().token}`},body:o});if(!s.ok)throw new Error("Error al subir la imagen");const a=await s.json();if(!a.profilePicture)throw new Error("No se devolviÃ³ la URL de la imagen");return localStorage.setItem("user",JSON.stringify(a)),e(d=>({user:{...d.user,profilePicture:a.profilePicture}})),a.profilePicture}catch(s){throw console.error(s),new Error("Error uploading profile picture")}},googleLogin:async r=>{try{let o=JSON.stringify({email:r});return await(await fetch(`${p}/auth/google/signin`,{method:"POST",headers:{"Content-Type":"application/json"},body:o})).json()}catch(n){throw new Error("text",n)}}}));export{re as c,se as u};
